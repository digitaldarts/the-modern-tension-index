<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Tension Index 2025</title>
    
    <!-- Import Vega & Vega-Lite Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5.25.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.15.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.22.1"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: #333;
            margin: 0;
            padding: 10px;
            background-color: #fff;
        }
        #visualization {
            width: 100%;
        }
        .chart-header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .chart-title h1 {
            font-size: 22px;
            margin: 0 0 5px 0;
            font-weight: 700;
        }
        .chart-title p {
            font-size: 15px;
            margin: 0;
            color: #666;
        }
        .filters {
            display: flex;
            gap: 8px;
        }
        .filters button {
            font-family: inherit;
            font-size: 13px;
            font-weight: 500;
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background-color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .filters button:hover {
            background-color: #f0f0f0;
            border-color: #ccc;
        }
        .filters button.active {
            background-color: #333;
            color: white;
            border-color: #333;
        }
    </style>
</head>
<body>

    <div class="chart-header-container">
        <div class="chart-title">
            <h1>Modern Tension Index 2025</h1>
            <p>Comparing daily strain across 40 countries.</p>
        </div>
        <div class="filters">
            <button id="filter-all" class="active">All Regions</button>
            <button id="filter-americas">Americas</button>
            <button id="filter-europe">Europe</button>
            <button id="filter-asia-oceania">Asia & Oceania</button>
        </div>
    </div>

    <div id="visualization"></div>

    <script>
        const spec = {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "config": {
              "background": "#ffffff",
              "view": {"stroke": null},
              "font": "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif"
          },
          "data": {
            "name": "myData",
            "values": [
              {"Country": "South Korea", "Sleep_Hours": 7.85, "Screen_Hours": 5.7, "Annual_Work_Hours": 1915, "Tension_Index_v1": 81.7, "Region": "Asia & Oceania"},
              {"Country": "Mexico", "Sleep_Hours": 8.1, "Screen_Hours": 8.1, "Annual_Work_Hours": 2128, "Tension_Index_v1": 91.7, "Region": "Americas"},
              {"Country": "Brazil", "Sleep_Hours": 7.5, "Screen_Hours": 9.5, "Annual_Work_Hours": 1491, "Tension_Index_v1": 77.0, "Region": "Americas"},
              {"Country": "Japan", "Sleep_Hours": 6.48, "Screen_Hours": 4.5, "Annual_Work_Hours": 1607, "Tension_Index_v1": 70.3, "Region": "Asia & Oceania"},
              {"Country": "Colombia", "Sleep_Hours": 7.8, "Screen_Hours": 9.1, "Annual_Work_Hours": 1964, "Tension_Index_v1": 89.7, "Region": "Americas"},
              {"Country": "Indonesia", "Sleep_Hours": 7.4, "Screen_Hours": 8.6, "Annual_Work_Hours": 1740, "Tension_Index_v1": 84.7, "Region": "Asia & Oceania"},
              {"Country": "Chile", "Sleep_Hours": 8.0, "Screen_Hours": 8.3, "Annual_Work_Hours": 1916, "Tension_Index_v1": 83.7, "Region": "Americas"},
              {"Country": "United States", "Sleep_Hours": 7.4, "Screen_Hours": 7.1, "Annual_Work_Hours": 1791, "Tension_Index_v1": 87.7, "Region": "Americas"},
              {"Country": "Philippines", "Sleep_Hours": 6.8, "Screen_Hours": 9.2, "Annual_Work_Hours": 1850, "Tension_Index_v1": 91.3, "Region": "Asia & Oceania"},
              {"Country": "Thailand", "Sleep_Hours": 7.2, "Screen_Hours": 8.7, "Annual_Work_Hours": 1820, "Tension_Index_v1": 88.3, "Region": "Asia & Oceania"},
              {"Country": "India", "Sleep_Hours": 7.9, "Screen_Hours": 6.9, "Annual_Work_Hours": 1900, "Tension_Index_v1": 85.0, "Region": "Asia & Oceania"},
              {"Country": "United Kingdom", "Sleep_Hours": 7.42, "Screen_Hours": 5.9, "Annual_Work_Hours": 1532, "Tension_Index_v1": 72.0, "Region": "Europe"},
              {"Country": "Germany", "Sleep_Hours": 7.75, "Screen_Hours": 5.5, "Annual_Work_Hours": 1341, "Tension_Index_v1": 60.7, "Region": "Europe"},
              {"Country": "France", "Sleep_Hours": 7.29, "Screen_Hours": 5.3, "Annual_Work_Hours": 1511, "Tension_Index_v1": 69.3, "Region": "Europe"},
              {"Country": "Italy", "Sleep_Hours": 7.6, "Screen_Hours": 6.2, "Annual_Work_Hours": 1669, "Tension_Index_v1": 77.3, "Region": "Europe"},
              {"Country": "Spain", "Sleep_Hours": 7.6, "Screen_Hours": 6.4, "Annual_Work_Hours": 1644, "Tension_Index_v1": 77.0, "Region": "Europe"},
              {"Country": "Canada", "Sleep_Hours": 7.5, "Screen_Hours": 6.7, "Annual_Work_Hours": 1685, "Tension_Index_v1": 81.0, "Region": "Americas"},
              {"Country": "Australia", "Sleep_Hours": 7.35, "Screen_Hours": 6.1, "Annual_Work_Hours": 1707, "Tension_Index_v1": 79.7, "Region": "Asia & Oceania"},
              {"Country": "Netherlands", "Sleep_Hours": 8.0, "Screen_Hours": 5.8, "Annual_Work_Hours": 1427, "Tension_Index_v1": 62.0, "Region": "Europe"},
              {"Country": "Switzerland", "Sleep_Hours": 7.8, "Screen_Hours": 5.1, "Annual_Work_Hours": 1573, "Tension_Index_v1": 67.0, "Region": "Europe"},
              {"Country": "Sweden", "Sleep_Hours": 7.5, "Screen_Hours": 6.0, "Annual_Work_Hours": 1440, "Tension_Index_v1": 68.7, "Region": "Europe"},
              {"Country": "Norway", "Sleep_Hours": 7.6, "Screen_Hours": 5.9, "Annual_Work_Hours": 1427, "Tension_Index_v1": 66.7, "Region": "Europe"},
              {"Country": "Denmark", "Sleep_Hours": 7.9, "Screen_Hours": 5.7, "Annual_Work_Hours": 1372, "Tension_Index_v1": 60.3, "Region": "Europe"},
              {"Country": "Finland", "Sleep_Hours": 7.8, "Screen_Hours": 5.6, "Annual_Work_Hours": 1550, "Tension_Index_v1": 68.0, "Region": "Europe"},
              {"Country": "Belgium", "Sleep_Hours": 7.7, "Screen_Hours": 5.9, "Annual_Work_Hours": 1585, "Tension_Index_v1": 71.7, "Region": "Europe"},
              {"Country": "Austria", "Sleep_Hours": 7.9, "Screen_Hours": 5.4, "Annual_Work_Hours": 1400, "Tension_Index_v1": 60.3, "Region": "Europe"},
              {"Country": "Portugal", "Sleep_Hours": 7.4, "Screen_Hours": 7.8, "Annual_Work_Hours": 1720, "Tension_Index_v1": 87.7, "Region": "Europe"},
              {"Country": "Ireland", "Sleep_Hours": 7.5, "Screen_Hours": 6.3, "Annual_Work_Hours": 1775, "Tension_Index_v1": 83.0, "Region": "Europe"},
              {"Country": "New Zealand", "Sleep_Hours": 7.6, "Screen_Hours": 5.9, "Annual_Work_Hours": 1748, "Tension_Index_v1": 79.3, "Region": "Asia & Oceania"},
              {"Country": "Poland", "Sleep_Hours": 7.2, "Screen_Hours": 6.6, "Annual_Work_Hours": 1830, "Tension_Index_v1": 87.3, "Region": "Europe"},
              {"Country": "Argentina", "Sleep_Hours": 8.2, "Screen_Hours": 9.4, "Annual_Work_Hours": 1600, "Tension_Index_v1": 73.3, "Region": "Americas"},
              {"Country": "Malaysia", "Sleep_Hours": 7.1, "Screen_Hours": 8.2, "Annual_Work_Hours": 1870, "Tension_Index_v1": 88.3, "Region": "Asia & Oceania"},
              {"Country": "Singapore", "Sleep_Hours": 7.0, "Screen_Hours": 7.3, "Annual_Work_Hours": 1890, "Tension_Index_v1": 92.3, "Region": "Asia & Oceania"},
              {"Country": "Vietnam", "Sleep_Hours": 6.9, "Screen_Hours": 6.8, "Annual_Work_Hours": 1950, "Tension_Index_v1": 92.0, "Region": "Asia & Oceania"},
              {"Country": "China", "Sleep_Hours": 8.5, "Screen_Hours": 5.9, "Annual_Work_Hours": 2174, "Tension_Index_v1": 78.0, "Region": "Asia & Oceania"},
              {"Country": "Turkey", "Sleep_Hours": 8.3, "Screen_Hours": 7.9, "Annual_Work_Hours": 1832, "Tension_Index_v1": 82.7, "Region": "Asia & Oceania"},
              {"Country": "Russia", "Sleep_Hours": 7.7, "Screen_Hours": 7.8, "Annual_Work_Hours": 1965, "Tension_Index_v1": 93.0, "Region": "Europe"},
              {"Country": "South Africa", "Sleep_Hours": 7.6, "Screen_Hours": 9.3, "Annual_Work_Hours": 1500, "Tension_Index_v1": 75.7, "Region": "Asia & Oceania"},
              {"Country": "Saudi Arabia", "Sleep_Hours": 7.2, "Screen_Hours": 8.5, "Annual_Work_Hours": 1980, "Tension_Index_v1": 92.3, "Region": "Asia & Oceania"},
              {"Country": "United Arab Emirates", "Sleep_Hours": 7.0, "Screen_Hours": 8.0, "Annual_Work_Hours": 2050, "Tension_Index_v1": 99.0, "Region": "Asia & Oceania"}
            ]
          },
          "params": [
            {"name": "region_selection", "value": null}
          ],
          "hconcat": [
            {
              "width": "container",
              "height": 400,
              "layer": [
                {
                  "data": {
                    "url": "https://raw.githubusercontent.com/vega/vega-datasets/main/data/world-110m.json",
                    "format": {"type": "topojson", "feature": "countries"}
                  },
                  "mark": {"type": "geoshape", "fill": "#f0f0f0", "stroke": "#e0e0e0", "strokeWidth": 0.5},
                  "projection": {"type": "naturalEarth1"}
                },
                {
                   "transform": [
                     {"filter": "region_selection == null || datum.Region == region_selection"},
                     {
                       "lookup": "Country",
                       "from": {
                         "data": {
                           "url": "https://raw.githubusercontent.com/vega/vega-datasets/main/data/world-110m.json",
                           "format": {"type": "topojson", "feature": "countries"}
                         },
                         "key": "properties.name"
                       },
                       "as": "geo"
                     },
                     {"filter": "datum.geo"}
                   ],
                   "projection": {"type": "naturalEarth1"},
                   "mark": {"type": "geoshape", "stroke": "#fff", "strokeWidth": 0.5},
                   "encoding": {
                     "shape": {"field": "geo", "type": "geojson"},
                     "color": {
                       "field": "Tension_Index_v1",
                       "type": "quantitative",
                       "scale": {"scheme": "redyellowgreen", "domain": [100, 0]},
                       "legend": {"orient": "bottom-left", "title": "Tension Index", "gradientLength": 150}
                     },
                     "tooltip": [
                       {"field": "Country", "type": "nominal"},
                       {"field": "Tension_Index_v1", "type": "quantitative", "title": "Tension Index"},
                       {"field": "Sleep_Hours", "type": "quantitative", "title": "Sleep Hours"},
                       {"field": "Screen_Hours", "type": "quantitative", "title": "Screen Hours"},
                       {"field": "Annual_Work_Hours", "type": "quantitative", "title": "Annual Work Hours"}
                     ]
                   }
                }
              ]
            },
            {
              "width": 200,
              "height": 400,
              "title": {"text": "Top 20 Ranking", "anchor": "start", "offset": 10},
              "transform": [
                 {"filter": "region_selection == null || datum.Region == region_selection"},
                 {"window": [{"op": "rank", "as": "rank"}], "sort": [{"field": "Tension_Index_v1", "order": "descending"}]},
                 {"filter": "datum.rank <= 20"}
              ],
              "mark": {"type": "bar", "cornerRadiusEnd": 2},
              "encoding": {
                "y": {
                    "field": "Country",
                    "type": "nominal",
                    "sort": "-x",
                    "axis": {
                        "title": null,
                        "minExtent": 140,
                        "maxExtent": 140,
                        "tickBand": "extent"
                    }
                },
                "x": {
                    "field": "Tension_Index_v1",
                    "type": "quantitative",
                    "axis": {"title": "Tension Index", "grid": false}
                },
                "color": {
                  "field": "Tension_Index_v1",
                  "type": "quantitative",
                  "scale": {"scheme": "redyellowgreen", "domain": [100, 0]},
                  "legend": null
                },
                "tooltip": [
                  {"field": "Country", "type": "nominal"},
                  {"field": "Tension_Index_v1", "type": "quantitative", "title": "Index Score"}
                ]
              }
            }
          ]
        };

        let vegaView;
        vegaEmbed('#visualization', spec, {actions: false}).then(result => {
            vegaView = result.view;
            
            // Attach standard JS listeners to the buttons
            document.getElementById('filter-all').addEventListener('click', function() { updateFilter(this, null); });
            document.getElementById('filter-americas').addEventListener('click', function() { updateFilter(this, 'Americas'); });
            document.getElementById('filter-europe').addEventListener('click', function() { updateFilter(this, 'Europe'); });
            document.getElementById('filter-asia-oceania').addEventListener('click', function() { updateFilter(this, 'Asia & Oceania'); });

        }).catch(console.error);

        function updateFilter(activeBtn, region) {
            // Update active button state
            document.querySelectorAll('.filters button').forEach(btn => btn.classList.remove('active'));
            activeBtn.classList.add('active');
            // Update Vega signal
            vegaView.signal('region_selection', region).runAsync();
        }

    </script>
</body>
</html>
