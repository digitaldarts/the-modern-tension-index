<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Modern Tension Index 2025 – Interactive Map</title>

<script src="https://unpkg.com/d3@7"></script>
<script src="https://unpkg.com/topojson-client@3"></script>

<style>
body {
  margin: 0;
  background: #fff;
  color: #222;
  font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}
.wrap {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}
.header p { max-width: 700px; }
.svg-wrap { position: relative; width: 100%; height: auto; }
.tooltip {
  position: fixed;
  pointer-events: none;
  background: rgba(0,0,0,0.85);
  color: #fff;
  font-size: 13px;
  padding: 8px 10px;
  border-radius: 6px;
  line-height: 1.4;
  opacity: 0;
  transition: opacity .15s ease;
  z-index: 10;
  max-width: 260px;
}
.legend {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 10px 0 25px 0;
  font-size: 0.9rem;
  color: #555;
}
.legend-bar {
  height: 10px;
  flex: 1;
  background: linear-gradient(90deg,#2ecc71 0%,#f1c40f 50%,#e74c3c 100%);
  border-radius: 999px;
  border: 1px solid #ddd;
}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <h2>Modern Tension Index 2025</h2>
    <p>Each country’s score runs from 0–100. Higher means more tension: less sleep, more screen time, and longer work hours.</p>
  </div>
  <div class="legend">
    <span>Low</span>
    <div class="legend-bar"></div>
    <span>High</span>
  </div>
  <div class="svg-wrap">
    <svg id="map" viewBox="0 0 960 520"></svg>
  </div>
  <p style="color:#555;font-size:0.9rem;margin-top:10px;">Data sources: WorldPopulationReview 2025, DataReportal 2025, OECD/ILO 2024.</p>
</div>
<div class="tooltip" id="tooltip"></div>

<script>
(async function(){
  const CSV_URL = "https://cdn.shopify.com/s/files/1/0674/7278/5560/files/modern_tension_index_2025.csv";

  const csv = await d3.csv(CSV_URL);
  const data = new Map();
  csv.forEach(d => {
    const name = d.Country?.trim();
    const score = +d.Tension_Index_v1;
    if(name && isFinite(score)) data.set(name, score);
  });

  const world = await d3.json("https://unpkg.com/world-atlas@2/countries-110m.json");
  const countries = topojson.feature(world, world.objects.countries).features;

  const svg = d3.select("#map");
  const width = 960, height = 520;
  const projection = d3.geoNaturalEarth1().fitExtent([[5,5],[width-5,height-5]], {type:"Sphere"});
  const path = d3.geoPath(projection);

  const color = d3.scaleLinear()
    .domain([20,50,80])
    .range(["#2ecc71","#f1c40f","#e74c3c"])
    .clamp(true);

  const tooltip = d3.select("#tooltip");

  const nameFix = n => n
    .replace("United States of America","United States")
    .replace("Russian Federation","Russia")
    .replace("Korea, Republic of","South Korea")
    .replace("United Kingdom of Great Britain and Northern Ireland","United Kingdom")
    .replace("Viet Nam","Vietnam")
    .replace("Iran, Islamic Republic of","Iran")
    .replace("Turkey","Turkey")
    .replace("UAE","United Arab Emirates")
    .replace("Republic of Korea","South Korea")
    .replace("Czech Republic","Czechia")
    .trim();

  svg.append("path")
    .attr("d", path({type:"Sphere"}))
    .attr("fill", "#f8f8f8");

  svg.selectAll("path.country")
    .data(countries)
    .join("path")
    .attr("class","country")
    .attr("d", path)
    .attr("fill", d => {
      const n = nameFix(d.properties.name);
      const val = data.get(n);
      return isFinite(val) ? color(val) : "#ddd";
    })
    .attr("stroke","#fff")
    .attr("stroke-width",0.5)
    .on("mousemove", (event,d)=>{
      const n = nameFix(d.properties.name);
      const v = data.get(n);
      if(!v) { tooltip.style("opacity",0); return; }
      tooltip.html(`<strong>${n}</strong><br>Tension: ${v.toFixed(1)} / 100`)
        .style("left",(event.clientX+14)+"px")
        .style("top",(event.clientY+14)+"px")
        .style("opacity",1);
    })
    .on("mouseleave", ()=>tooltip.style("opacity",0));
})();
</script>
</body>
</html>
